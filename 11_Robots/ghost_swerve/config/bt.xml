<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4"
      main_tree_to_execute="full_auton">
      <!-- main_tree_to_execute="search_and_destroy"> -->
  <BehaviorTree ID="far_triball">
    <Sequence>
      <Logging message="started"/>
      <!-- <MoveToPoseCubic posX="1.5"
                  posY="-2.5"
                  theta="0"
                  velX="0.00"
                  velY="0.0"
                  omega="0.0"
                  threshold="0.08"
                  angle_threshold="2.0"
                  timeout="1000"
                  speed="0.5"/> -->
      <MoveToPoseCubic posX="2.0"
                  posY="-2.0"
                  theta="135"
                  velX="0.00"
                  velY="0.0"
                  omega="0.0"
                  threshold="0.05"
                  angle_threshold="5.0"
                  timeout="-1000"
                  speed="0.5"/>
      <ReactiveFallback>
        <IntakeCmd in="true"/>
        <MoveToPoseCubic posX="2.6"
                    posY="-2.6"
                    theta="135"
                    velX="0.0"
                    velY="0.0"
                    omega="0.0"
                    threshold="0.05"
                    angle_threshold="5.0"
                    timeout="-3000"
                    speed="0.5"/>
      </ReactiveFallback>
      <MoveToPoseCubic posX="2.0"
                  posY="-2.0"
                  theta="135"
                  velX="0.00"
                  velY="0.0"
                  omega="0.0"
                  threshold="0.05"
                  angle_threshold="5.0"
                  timeout="-1000"
                  speed="0.5"/>
      <MoveToPoseCubic posX="2.0"
                  posY="-1.8"
                  theta="135"
                  velX="0.0"
                  velY="0.0"
                  omega="0.0"
                  threshold="0.10"
                  angle_threshold="5.0"
                  timeout="-2000"
                  speed="0.5"/>
      <SubTree ID="score"
               _autoremap="false"/>
      <!-- <KeepRunningUntilFailure>
        <CheckForRestart/>
      </KeepRunningUntilFailure> -->
    </Sequence>
  </BehaviorTree>
  <BehaviorTree ID="score">
    <Sequence>
      <MoveToPoseCubic posX="0.5"
                  posY="-1.2"
                  theta="180"
                  velX="0.0"
                  velY="0.0"
                  omega="0.0"
                  threshold="0.10"
                  angle_threshold="5.0"
                  timeout="-1500"
                  speed="0.5"/>
      <MoveToPoseCubic posX="1.0"
                  posY="-0.35"
                  theta="180"
                  velX="0.0"
                  velY="0.0"
                  omega="0.0"
                  threshold="0.10"
                  angle_threshold="5.0"
                  timeout="-2500"
                  speed="0.5"/>
      <ReactiveFallback>
        <IntakeCmd in="false"/>
        <MoveToPoseCubic posX="2.0"
                    posY="-0.35"
                    theta="180"
                    velX="0.0"
                    velY="0.0"
                    omega="0.0"
                    threshold="0.10"
                    angle_threshold="5.0"
                    timeout="-1500"
                    speed="0.5"/>
      </ReactiveFallback>
      <MoveToPoseCubic posX="1.0"
                  posY="-0.35"
                  theta="180"
                  velX="0.0"
                  velY="0.0"
                  omega="0.0"
                  threshold="0.10"
                  angle_threshold="5.0"
                  timeout="-1000"
                  speed="0.5"/>
      <!-- <MoveToPoseCubic posX="1.0"
                  posY="-1.2"
                  theta="135"
                  velX="0.0"
                  velY="0.0"
                  omega="0.0"
                  threshold="0.10"
                  angle_threshold="5.0"
                  timeout="-1500"
                  speed="0.5"/> -->
    </Sequence>
  </BehaviorTree>
 
  <BehaviorTree ID="close_triball">
    <Sequence>
      <Logging message="close triball"/>
      <ReactiveFallback>
        <IntakeCmd in="true"/>
        <Delay delay_msec="3000">
          <MoveToPoseCubic posX="-1.0"
                      posY="-2.5"
                      theta="0"
                      velX="0.0"
                      velY="0.0"
                      omega="0.0"
                      threshold="0.05"
                      angle_threshold="5.0"
                      timeout="-1000"
                      speed="0.5"/>
        </Delay>
      </ReactiveFallback>
      <MoveToPoseCubic posX="1.8"
                  posY="-2.5"
                  theta="0"
                  velX="0.00"
                  velY="0.0"
                  omega="0.0"
                  threshold="0.10"
                  angle_threshold="5.0"
                  timeout="-4000"
                  speed="0.7"/>
      <MoveToPoseCubic posX="2.2"
                  posY="-1.8"
                  theta="45"
                  velX="0.00"
                  velY="0.0"
                  omega="0"
                  threshold="0.08"
                  angle_threshold="2.0"
                  timeout="-1500"
                  speed="0.5"/>
      <MoveToPoseCubic posX="2.0"
                  posY="-1.8"
                  theta="135"
                  velX="0.0"
                  velY="0.0"
                  omega="0.0"
                  threshold="0.10"
                  angle_threshold="5.0"
                  timeout="-2000"
                  speed="0.5"/>
      <MoveToPoseCubic posX="1.0"
                  posY="-1.2"
                  theta="135"
                  velX="0.0"
                  velY="0.0"
                  omega="0.0"
                  threshold="0.10"
                  angle_threshold="5.0"
                  timeout="-1500"
                  speed="0.5"/>
      <SubTree ID="score"
               _autoremap="false"/>
      <!-- <KeepRunningUntilFailure>
        <CheckForRestart/>
      </KeepRunningUntilFailure>
      <RetryUntilSuccessful num_attempts="-1">
        <AutoDone/>
      </RetryUntilSuccessful> -->
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="full_auton">
    <Sequence>
      <SubTree ID="close_triball"
               _autoremap="false"/>
      <!-- <MoveToPoseCubic posX="2.0"
                  posY="-1.8"
                  theta="135"
                  velX="0.0"
                  velY="0.0"
                  omega="0.0"
                  threshold="0.05"
                  angle_threshold="5.0"
                  timeout="-1500"
                  speed="0.5"/> -->
      <!-- <SubTree ID="far_triball"
               _autoremap="false"/> -->
      <SubTree ID="search_and_destroy"
               _autoremap="false"/>
      <KeepRunningUntilFailure>
        <CheckForRestart/>
      </KeepRunningUntilFailure>
      <RetryUntilSuccessful num_attempts="-1">
        <AutoDone/>
      </RetryUntilSuccessful>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="search_and_destroy">
    <Fallback>
      <Timeout msec="15000">
        <Repeat num_cycles="4">
          <Fallback>
            <ReactiveSequence>
              <Inverter>
                <IntakeCmd in="true"/>
              </Inverter>
              <SubTree ID="starting_balls"/>
            </ReactiveSequence>
            <SubTree ID="score"/>
          </Fallback>
        </Repeat>
      </Timeout>
      <KeepRunningUntilFailure>
        <Sequence>
          <ReactiveFallback>
            <IntakeCmd in="true"/>
            <KeepRunningUntilFailure>
              <SubTree ID="loop_goal"/>
            </KeepRunningUntilFailure>
          </ReactiveFallback>
          <SubTree ID="score"/>
        </Sequence>
      </KeepRunningUntilFailure>
    </Fallback>
  </BehaviorTree>

  <BehaviorTree ID="starting_balls">
    <Sequence>
      <MoveToPoseCubic posX="0.3"
                       posY="-0.7"
                       theta="-90"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-1500"
                       speed="0.5"/>
      <MoveToPoseCubic posX="0.3"
                       posY="-0.4"
                       theta="-90"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-1500"
                       speed="0.5"/>
      <MoveToPoseCubic posX="0.3"
                       posY="0.2"
                       theta="-90"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-1500"
                       speed="0.5"/>
      <MoveToPoseCubic posX="1.0"
                       posY="-0.4"
                       theta="-90"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-1500"
                       speed="0.5"/>
      <MoveToPoseCubic posX="1.0"
                       posY="0.2"
                       theta="-90"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-1500"
                       speed="0.5"/>
      </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="loop_goal">
    <Sequence>
      <MoveToPoseCubic posX="1.5"
                       posY="-0.5"
                       theta="0"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-1500"
                       speed="0.3"/>
      <MoveToPoseCubic posX="0.6"
                       posY="-0.5"
                       theta="0"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-1500"
                       speed="0.3"/>
      <MoveToPoseCubic posX="1.5"
                       posY="-1.0"
                       theta="0"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-1500"
                       speed="0.3"/>
      <MoveToPoseCubic posX="0.6"
                       posY="-1.0"
                       theta="0"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-1500"
                       speed="0.3"/>
      <MoveToPoseCubic posX="1.5"
                       posY="-1.5"
                       theta="0"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-1500"
                       speed="0.3"/>
      <MoveToPoseCubic posX="0.6"
                       posY="-1.5"
                       theta="0"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-1500"
                       speed="0.3"/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="climb">
    <Sequence>
      <!-- <MoveToPoseCubic posX="1.5"
                       posY="-2.0"
                       theta="180"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-3000"
                       speed="0.3"/>
      <MoveToPoseCubic posX="0.5"
                       posY="-2.0"
                       theta="180"
                       velX="0.0"
                       velY="0.0"
                       omega="0.0"
                       threshold="0.05"
                       angle_threshold="5.0"
                       timeout="-3000"
                       speed="0.1"/> -->
      <Climb/>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="CheckForRestart"
            editable="true"/>
    <Action ID="Climb"
            editable="true"/>
    <!-- <Action ID="AutoDone"
            editable="true"/> -->
    <Action ID="IntakeCmd"
            editable="true">
      <input_port name="in"/>
    </Action>
    <Action ID="Logging"
            editable="true">
      <input_port name="message"/>
    </Action>
    <Action ID="MoveToPoseCubic"
            editable="true">
      <input_port name="posX">m</input_port>
      <input_port name="posY">m</input_port>
      <input_port name="theta">deg</input_port>
      <input_port name="velX">m.s</input_port>
      <input_port name="velY">m.s</input_port>
      <input_port name="omega">deg.s</input_port>
      <input_port name="threshold"
                  default="0.025">m</input_port>
      <input_port name="angle_threshold"
                  default="5.0">m</input_port>
      <input_port name="timeout"
                  default="5000">ms</input_port>
      <input_port name="speed"
                  default="0.5">m.s</input_port>
    </Action>
    <Action ID="MoveToPoseTrapezoid"
            editable="true">
      <input_port name="posX">m</input_port>
      <input_port name="posY">m</input_port>
      <input_port name="theta">deg</input_port>
      <input_port name="velX">m.s</input_port>
      <input_port name="velY">m.s</input_port>
      <input_port name="omega">deg.s</input_port>
      <input_port name="threshold"
                  default="0.025">m</input_port>
      <input_port name="angle_threshold"
                  default="5.0">m</input_port>
      <input_port name="timeout"
                  default="5000">ms</input_port>
      <input_port name="max_speed"
                  default="0.5">m.s</input_port>
    </Action>
  </TreeNodesModel>

</root>
